{"version":3,"sources":["good_detail.js"],"names":["$","GoodsObj","init","goodsDetail","eventList","on","userStr","sessionStorage","getItem","mui","toast","setTimeout","setItem","location","href","token","JSON","parse","ajax","url","type","data","info","stringify","headers","Authorization","success","result","meta","status","confirm","editType","index","console","log","msg","get","goods_id","getUrl","cat_id","goods_name","goods_number","goods_price","goods_small_logo","goods_weight","html","template","gallery","slider","interval","reslut","name","reg","RegExp","r","window","search","substr","match","decodeURI"],"mappings":"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","sourcesContent":["$(function() {\r\n  /* \r\n  1 点击 “加入购物车” tap事件\r\n    1 获取本地存储中的一个   userinfo\r\n    2 判断 userinfo 是否为null \r\n      1 null 没有登录过    =>   1 弹出对话框 您还没登录 2 延迟跳转页面 登录页面\r\n    3 登录过了 构造参数 完成 添加到 购物车的功能\r\n  2 准备参数 发送请求完成登录   添加到购物车功能 必须要用到token\r\n    1 准备参数  从第一次获取数据的时候  来获取  \r\n    2 准备发送请求 添加到购物车\r\n    3 在api文档的最开头已经有说明\r\n      1 把token从本地存储中获取出来\r\n      2 把token存放到请求头\r\n           \"Authorization\" : token\r\n  3 加入购物车成功\r\n    1 弹出 确认框 mui消息提示框 \r\n    2 跳转的时候 跳转到购物车页面\r\n    3 取消的时候 就什么都不做\r\n  \r\n   */\r\n\r\n  // 商品信息对象\r\n  let GoodsObj = {};\r\n\r\n  init();\r\n  function init() {\r\n    goodsDetail();\r\n    eventList();\r\n  }\r\n\r\n  function eventList() {\r\n    // 绑定 加入购物车 点击 事件\r\n    $(\".shopping_car_btn\").on(\"tap\", function() {\r\n\r\n\r\n      \r\n  \r\n      // 1 获取 本地存储中的数据 userinfo sessionStorage\r\n      // 要么是正常 字符串 要么就是 null\r\n      let userStr = sessionStorage.getItem(\"userinfo\");\r\n      // 1.1 判断是否存在\r\n      if (!userStr) {\r\n        mui.toast(\"您还没有登录\");\r\n        setTimeout(() => {\r\n          // 把 当前的url存入到会话存储中 方便 登录成功之后 跳回来\r\n          sessionStorage.setItem(\"pageurl\", location.href);\r\n\r\n          location.href = \"login.html\";\r\n        }, 1000);\r\n      } else {\r\n        // console.log(\"已经登录过了 准备添加到购物车\");\r\n        // 2.2 发送数据到后台完成 功能\r\n        // 必须要带上token到后台去 否则都是失败！！！\r\n        // 2.3 把token取出来\r\n        let token = JSON.parse(userStr).token;\r\n        // 2.4 把token存入到请求头中\r\n        // 2.4.1 $.post 简洁的ajax的方法 没有办法添加请求头信息，要给ajax添加请求头的时候 必须要使用 $.ajax\r\n        $.ajax({\r\n          url: \"http://api.pyg.ak48.xyz/api/public/v1/my/cart/add\",\r\n          type: \"post\",\r\n          data: {\r\n            info: JSON.stringify(GoodsObj)\r\n          },\r\n          // 请求头的配置\r\n          headers: {\r\n            Authorization: token\r\n          },\r\n          success: function(result) {\r\n            // console.log(result);\r\n            // 判断请求是否成功\r\n            if(result.meta.status==200){\r\n              // 成功\r\n              mui.confirm(\"您是否要跳转到购物车页面？\",\"添加成功\",[\"跳转\",\"取消\"],function (editType) {\r\n                // 判断 用户点击的按钮\r\n                if(editType.index==0){\r\n                  // 跳转\r\n                  // console.log(\"跳转\");\r\n                  location.href=\"cart.html\";\r\n        \r\n                }else if(editType.index==1){\r\n                  // 取消\r\n                  console.log(\"取消\");\r\n                }\r\n                \r\n              })\r\n            }else{\r\n              // 失败\r\n              mui.toast(result.meta.msg);\r\n            }\r\n          }\r\n        });\r\n        //   $.post(\"http://api.pyg.ak48.xyz/api/public/v1/my/cart/add\",{\r\n        //     info:JSON.stringify(GoodsObj)\r\n        //   },function (result) {\r\n        //     console.log(result);\r\n\r\n        //   })\r\n      }\r\n    });\r\n  }\r\n\r\n  function goodsDetail() {\r\n    $.get(\r\n      \"http://api.pyg.ak48.xyz/api/public/v1/goods/detail\",\r\n      {\r\n        goods_id: getUrl(\"goods_id\")\r\n      },\r\n      function(result) {\r\n        // console.log(result);\r\n        if (result.meta.status == 200) {\r\n          // 给全局的商品信息对象赋值\r\n          GoodsObj = {\r\n            cat_id: result.data.cat_id,\r\n            goods_id: result.data.goods_id,\r\n            goods_name: result.data.goods_name,\r\n            goods_number: result.data.goods_number,\r\n            goods_price: result.data.goods_price,\r\n            goods_small_logo: result.data.goods_small_logo,\r\n            goods_weight: result.data.goods_weight\r\n          };\r\n\r\n          //  模板需要渲染 整个商品的详情部分  所有的数据都要传递到 模板引擎中\r\n          let data = result.data;\r\n          // data={... pics:[]}\r\n          let html = template(\"mainTpl\", data);\r\n          // let html=template(\"mainTpl\",{pics:data.pics,goods_name:艾美特});\r\n\r\n          // let html=template(\"id\",{arr:result.data})   第二个参数的格式是一个对象\r\n\r\n          $(\".pyg_view\").html(html);\r\n\r\n          // 轮播图的js 初始\r\n          var gallery = mui(\".mui-slider\");\r\n          gallery.slider({\r\n            interval: 5000 //自动轮播周期，若为0则不自动播放，默认为0；\r\n          });\r\n        } else {\r\n          console.log(\"请求失败\", reslut);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  // 获取url上的参数 的值\r\n  function getUrl(name) {\r\n    var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n    var r = window.location.search.substr(1).match(reg);\r\n    if (r != null) return decodeURI(r[2]);\r\n    return null;\r\n  }\r\n});\r\n"],"file":"good_detail.js"}